{
  "ignition": {
    "version": "3.3.0"
  },
  "passwd": {
    "users": [
      {
        "groups": [
          "sudo"
        ],
        "name": "core",
        "passwordHash": "!",
        "sshAuthorizedKeys": [
          "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEYcqyGk3/+jtWv9gN2IxZnNfT3BhV3ljEueCPcxAGH4 ceo@haeicore.com.br"
        ]
      }
    ]
  },
  "storage": {
    "directories": [
      {
        "path": "/var/log/journal",
        "mode": 493
      },
      {
        "path": "/var/lib/nft",
        "mode": 493
      }
    ],
    "files": [
      {
        "path": "/etc/ssh/sshd_config.d/10-hardening.conf",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/1yQwW7bMAyG73oKPUDcxjLkYT3V7bINaLIVTTrsqsiEJdQWDZJO4rcv7AJt3Zv48RP5S49AXZQnRNliE5NOqB4d8xmprgYJkCR6JxHfOsPxBcYvfARWS7QDCViz7odjG/0LjGrnLpNyoAisi6nciyMZetbmpljfWDVv/0XOwyF2oIu1ekv2zECbdIqEqYMkUwr1AJeqbZCihI61H+gExtr8e8bBGVvetvHIHK6QmhUnoaH/VuaXd8Pm5hZ7SJPisVP3sQ9ArH1wPjizznpsx7xY28/WygEbW2aN7xaXd9U969A5P+/ObG4ykIWy+uhOA7501W9keYDx03uYQwb1HHdF7N4HfxTGlkpVbYvnqoEkP5HOjuqYmul3Zn7w/ZL+z/MleGb48Wc/nbbYbOEErf63ebr7u9+oO5cSkL4G8deReYCrBKJeAwAA///0HxUBKQIAAA=="
        },
        "mode": 420
      },
      {
        "path": "/etc/issue.net",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/1KmBHApK0CBo7NrcLC/QpBrcEiQZ4i/nkKIv4ujgmOIZ5ini6OLq8LhTgVffz/PEP8gRxdHPYgeZS7KLAcEAAD//5ZcZtW7AAAA"
        },
        "mode": 420
      },
      {
        "path": "/etc/sysctl.d/99-hardening.conf",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/4ySwW7cMAxE7/4KA7kra2eb5qJrLz0UaD9A4Ir0hrAsCSTtxn9fKEC6Cdpt9yYMZx6GhO7674TUZTLHdTs6izXonmMpM5P64TKJJU8OUnJSw8TJSP6YIk2wJvuHo+UhRqoWhJCFoqk/XMFcNz7eQnu8lfaum1LGG5r9x9ZIqZzDAmIM+cMZ24FlisPDw2c/dN1d/5UkU7r/8qObX19uriZBSE04mh/fZFxIzxd9eNPXXIU3TnQmDKuSZA0xlUz+8JtILxRDKoABWeGUCC/5HRZw1QQiBY2lkh+7SV2VYhSNMDyDYOI8tzU+DHRf3um6MgZcl9r4/tBW+3ZSkg1OnBgBqb/vkbbeSknaEpyL8bS7BV5ei4efYPGZ1H8aj+PT018tnNUgx/Y1D+Ox+xUAAP//Zv3nLL8CAAA="
        },
        "mode": 420
      },
      {
        "path": "/etc/nftables.conf",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3SSTW5TQQzH9znFX2LTikYJJURIWcKCLKBRg2A9mfFjDJPxMOPXNIpyCk7AGdixzcXQ+wLUtBvL8sfPf1uuQl08ch2okI7UbAKBIykqDkoZhxFgveFYWhfgmGrtfUD3iYZSL/KtT6fMkln3mC6QJLDdw2VJi77LKooaJVBpJnLx5K4yBaPkYKylpH0lc4UgQ6wPPsPyzfvV3QyBt6zGCZ53kTmoFIqWTcBF4vhl8uHt6nJAJaQsKlYC2G5TZ9oFyHoZZ/peU9EOitzIezUpZCU+1JTmiHSv3uWWcTc/07dev0M6/d4EtoLV7c2n5fr043Z5g4uGO25HXC5QKJ9+oiLrmyVMOv0q+Gg4FGsCDRe2CS5JVlxf/ztcpN3/Ql9MJ1uOtdKZks+0+avkjHh4Pb2azV4eH3Rl+kpWsWP17YL33ZWM23IcpyyeN6zk2upjayvJO5MdDucPMaSeeomeILU2j/MYYUg9Quh0d4zj6Dj6EwAA///f932hzgIAAA=="
        },
        "mode": 420
      },
      {
        "path": "/etc/nftables.open.conf",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3SR4W7qMAyF//cpzgOA4HK56Eo8TUhcxVsaZ447QKjvPtEWbTD4Y1k99ndOnTb1NUL7RJWsMXdIBM5kaDkZKS4N4KPjXMcW4Fx6m3vAzoVuo1HkfZaLsijbGes9iiT2ZwSVsp+3vKGaMwLVqyPXSGGhlJxRgPOeis2TzC2SPHwrKComXhLYd2UqYxLyUZZKHz1VQ+KODXr1+beq5CU/wssOmU4Wg46Mz929br4gFFHDZvOdOdPxJ/rPetVx7o1e7V7+rxfb7d/hXld6I284ssXR+zT9gAsd52VRiXxgozBOD2NtRY9OAy6/j36TXp19Jkhv18d5RrhJTwhT7IkxNEPzFQAA///vetxuMgIAAA=="
        },
        "mode": 420
      },
      {
        "path": "/etc/nftables.closed.conf",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3RSwWoUQRC971c84kUhwSXGIOQoAT1EhQ147umuoUt7p9rqmmSXZT9GPPgPXufHZGemUbKbS1FUvXqvXle3qS8R2icqZAtzTSJwR4aWk5FitwB8dNyVMQW4y73NOWDbTBUaRb7P7awsyrbF8gZZEvstgkq+mae8oZgzApWDIpdI4VwpOaMA5z1lm5HMLZLU2lx8gY/v776gGX4W9lKRGVnFxEsC+3Wewrgf+SgXSj96KobEazboQf3t60JeuqeS+RodbSwGHTkero/kV6sPWH2+u/10f4sHduDOSFvnCfeOU/EuEV4WWoM2WQoPv4dfgjz8aRJ79+o/a2dW8cszmM8IWdRweXkk+ZWaylAd/8Pv3i3Pr67e7J9MKX0jb3hki6OTzfQcLqy5u8gqkRs2CiN6P8ZW9NFpwO74sLX13GlnBunt8AFOMdTWCYZp74ljv9gv/gYAAP//rqBDY5YCAAA="
        },
        "mode": 420
      },
      {
        "path": "/usr/local/sbin/nft-close-when-tailscale.sh",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/2xRy67aMBDd+yumBsEqccsWAUJVqJBoKtGqmwohxxkTFzNObSdqBXxMv6U/VoWXuLp3fR5z5pzeO9EELwpDopChYgEjJNg4qE2NWhrLFqv5pwkXrfTCmkKQjiKEaqusC1hyluXfF8tVNuECoxJRGhuUtJiUbl9b9ydFajn7+CX/Nl/m2Xqbzz9nE/6gcWY0/IBEA+/fnDhsxhArJAiu8QqfkDFow1gPfv77CxpVJUs3Yzd1F5PDBgYDwN8mwvuOWDq1Rw+1x4AUccaUOxwklZC0d2wqSmwFNdbCaDr4AKfTk145itIQengkBu9KSd1ho+8ehkKNKnZBhsdj+jXKiOm6ITK0O5+HwPsvC+Awejp7gp3HGpJfEH2D198ZgKo7v0urpKMsLIb0WnqqHL1CHGkGcBkzdGuSjm/or6zoGlXdO2PasNvH/wMAAP//kO0Vnw0CAAA="
        },
        "mode": 493
      },
      {
        "path": "/etc/tailscale-dokploy.env",
        "contents": {
          "compression": "",
          "source": "data:,CONTAINER_NAME%3D%22tailscale%22%0A"
        },
        "mode": 420
      },
      {
        "path": "/etc/systemd/journald.conf.d/10-persistent-limited.conf",
        "contents": {
          "compression": "",
          "source": "data:,%5BJournal%5D%0AStorage%3Dpersistent%0ASystemMaxUse%3D250M%0ARuntimeMaxUse%3D100M%0ACompress%3Dyes%0A"
        },
        "mode": 420
      },
      {
        "path": "/etc/systemd/timesyncd.conf",
        "contents": {
          "compression": "",
          "source": "data:,%5BTime%5D%0ANTP%3Da.st1.ntp.br%20b.st1.ntp.br%0AFallbackNTP%3D0.pool.ntp.org%201.pool.ntp.org%0A"
        },
        "mode": 420
      },
      {
        "path": "/etc/timezone",
        "contents": {
          "compression": "",
          "source": "data:,America%2FSao_Paulo"
        },
        "mode": 420
      },
      {
        "path": "/etc/docker/daemon.json",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/zTNMQ6CUBAE0J5TbLbmGy1sSDyJsUAYyRrgk92FoIS7G/jSzrzJLBkRt7EJtcoE5YL4bbEPL2nB+VHGwY0LWoi7cg4mX2zwcu44T9HOC+Ir07qvMKM6ZnfuS5cJp6rROA7p6WYfc3Q1P3Yvg5fPFht3HZGeZUJQmEfFP8/W7BcAAP//ON+24rIAAAA="
        },
        "mode": 420
      },
      {
        "path": "/etc/systemd/system/docker.service.d/10-limits.conf",
        "contents": {
          "compression": "",
          "source": "data:,%5BService%5D%0ALimitNOFILE%3D1048576%0A"
        },
        "mode": 420
      },
      {
        "path": "/etc/locksmith/config.json",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/6rmUlBQKkpNys8viS8uKUosSU2vVLKCCSnpIEmXZ+al5JfHF5ckFpWAlBgYWxkYYFORk5qXXpIBUmKUocRVywUIAAD//9Ud77JkAAAA"
        },
        "mode": 420
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "[Unit]\nDescription=Set system timezone from /etc/timezone\nBefore=sshd.service\n[Service]\nType=oneshot\nExecStart=/usr/bin/timedatectl set-timezone $(cat /etc/timezone)\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "set-timezone.service"
      },
      {
        "contents": "[Unit]\nDescription=Apply nftables rules (Flatcar)\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nExecStart=/usr/sbin/nft -f /etc/nftables.conf\nRemainAfterExit=yes\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "nft-apply.service"
      },
      {
        "dropins": [
          {
            "contents": "[Unit]\nAfter=nft-apply.service\nWants=nft-apply.service\n",
            "name": "10-firewall-order.conf"
          }
        ],
        "name": "sshd.service"
      },
      {
        "enabled": true,
        "name": "docker.service"
      },
      {
        "enabled": true,
        "name": "docker.socket"
      },
      {
        "contents": "[Unit]\nDescription=Switch nftables to CLOSED profile when Tailscale container is up\n[Service]\nType=oneshot\nExecStart=/usr/local/sbin/nft-close-when-tailscale.sh\n",
        "name": "nft-close-ssh.service"
      },
      {
        "contents": "[Unit]\nDescription=Timer to close public SSH when Tailscale is running\n[Timer]\nOnBootSec=45s\nOnUnitInactiveSec=2m\nAccuracySec=30s\nUnit=nft-close-ssh.service\n[Install]\nWantedBy=timers.target\n",
        "enabled": true,
        "name": "nft-close-ssh.timer"
      },
      {
        "enabled": true,
        "name": "update-engine.service"
      },
      {
        "enabled": true,
        "name": "locksmithd.service"
      }
    ]
  }
}
